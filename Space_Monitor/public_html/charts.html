<!DOCTYPE html>
<html>

<head>
	<title> Cafe Monitor</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.bundle.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<link rel="stylesheet" type="text/css" href="style.css" />


	<style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
	<div id="block_container">
		<div id="block1">
			<canvas id="canvas1"></canvas>
		</div>
		<div id="block2">
			<canvas id="canvas2"></canvas>
		</div>
	</div>
	<div id="block_container">
		<div id="block1">
			<canvas id="canvas3"></canvas>
		</div>
		<div id="block2">
			<canvas id="canvas4"></canvas>
		</div>
	</div>



	<script>
		window.onload = function() {
			initLineChart(sensor_data);
		}

		var sensor_data = [30];
		// var socket = io();
		//
		// socket.on('latestSamples', function(incomingData) {
		// 	console.log(incomingData);
		// 	socket.emit('messageFromClientToServer', "received: " + incomingData);
		//
		// 	sensor_data = incomingData;
		//
		// 	initLineChart(sensor_data);
		// });

		var temperature_to_nm = function(celsius) {
			//map 15->35 to 450->650 nm
			if (celsius < 15) {
				celsius = 15;
			}
			if (celsius > 35) {
				celsius = 35;
			}
			return (celsius - 15) / (35 - 15) * (650 - 450) + 450;
		}


		nmToRGBA = function(wavelength) {
			var Gamma = 0.80,
				IntensityMax = 255,
				factor, red, green, blue;
			if ((wavelength >= 380) && (wavelength < 440)) {
				red = -(wavelength - 440) / (440 - 380);
				green = 0.0;
				blue = 1.0;
			} else if ((wavelength >= 440) && (wavelength < 490)) {
				red = 0.0;
				green = (wavelength - 440) / (490 - 440);
				blue = 1.0;
			} else if ((wavelength >= 490) && (wavelength < 510)) {
				red = 0.0;
				green = 1.0;
				blue = -(wavelength - 510) / (510 - 490);
			} else if ((wavelength >= 510) && (wavelength < 580)) {
				red = (wavelength - 510) / (580 - 510);
				green = 1.0;
				blue = 0.0;
			} else if ((wavelength >= 580) && (wavelength < 645)) {
				red = 1.0;
				green = -(wavelength - 645) / (645 - 580);
				blue = 0.0;
			} else if ((wavelength >= 645) && (wavelength < 781)) {
				red = 1.0;
				green = 0.0;
				blue = 0.0;
			} else {
				red = 0.0;
				green = 0.0;
				blue = 0.0;
			};
			// Let the intensity fall off near the vision limits
			if ((wavelength >= 380) && (wavelength < 420)) {
				factor = 0.3 + 0.7 * (wavelength - 380) / (420 - 380);
			} else if ((wavelength >= 420) && (wavelength < 701)) {
				factor = 1.0;
			} else if ((wavelength >= 701) && (wavelength < 781)) {
				factor = 0.3 + 0.7 * (780 - wavelength) / (780 - 700);
			} else {
				factor = 0.0;
			};
			if (red !== 0) {
				red = Math.round(IntensityMax * Math.pow(red * factor, Gamma));
			}
			if (green !== 0) {
				green = Math.round(IntensityMax * Math.pow(green * factor, Gamma));
			}
			if (blue !== 0) {
				blue = Math.round(IntensityMax * Math.pow(blue * factor, Gamma));
			}
			return "rgba(" + red + "," + green + "," + blue + "," + "1.0)";
		}



		var initLineChart = function(graph_data) {

			var rgba_string = nmToRGBA(temperature_to_nm(graph_data));

			var config = {
				type: 'bar',
				data: {
					labels: [""],
					datasets: [{
						label: "Temperature",
						data: graph_data,
						backgroundColor: rgba_string,
					}]
				},
				options: {
					animation: false,
					title: {
						display: true,
						text: "Temperature"
					},
					legend: {
						display: false,
					},
					tooltips: {
						//enabled: false,
					},
					scales: {
						xAxes: [{
							display: false,
							gridLines: {
								display: false,
							},
							scaleLabel: {
								show: false,
							}
						}],
						yAxes: [{
							display: false,
							gridLines: {
								display: false,
							},
							scaleLabel: {
								show: true,
								labelString: 'Value'
							},
						}]
					}
				}
			};

			var ctx1 = document.getElementById("canvas1").getContext("2d");
			window.myLine1 = new Chart(ctx1, config);
			var ctx2 = document.getElementById("canvas2").getContext("2d");
			window.myLine2 = new Chart(ctx2, config);
		}
	</script>
</body>

</html>
